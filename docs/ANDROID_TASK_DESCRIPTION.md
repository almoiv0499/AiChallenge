# Описание задачи: Android Chat AI Application

## Краткое описание

Реализовано Android-приложение для чата с AI ассистентом с использованием современного стека технологий и модульной архитектуры.

## Выполненные требования

### ✅ Технологический стек

- **MVVM** - реализована архитектура Model-View-ViewModel
- **Coroutines** - использованы для асинхронных операций
- **Flow / StateFlow** - реактивное программирование для UI
- **Dependency Injection (Koin)** - настроен для управления зависимостями
- **Network (Ktor)** - реализован клиент для работы с OpenRouter API
- **UI (Jetpack Compose)** - современный декларативный UI

### ✅ Хранение данных (Room)

- Реализована база данных Room для хранения истории чата
- Поля таблицы `chat_messages`:
  - `id` - уникальный идентификатор (Long, PrimaryKey)
  - `role` - роль сообщения (MessageRole: SYSTEM, USER, ASSISTANT, TOOL, MCP)
  - `content` - содержимое сообщения (String)
  - `timestamp` - временная метка (Long)
- **Восстановление истории:** реализовано через Flow, автоматически загружается при запуске приложения

### ✅ Модульная архитектура

- **Модуль `chatAI`** - отдельный модуль с бизнес-логикой (независим от Android UI)
- **Модуль `app`** - основной модуль приложения с UI
- Четкое разделение ответственности между слоями

### ✅ CI/CD (GitHub Actions)

- Настроен workflow для сборки проекта (`./gradlew :app:assembleDebug`)
- После успешной сборки:
  - Публикуется APK как artifact
  - Публикуется ZIP архив с APK
  - Оба артефакта доступны для скачивания из GitHub Actions

### ✅ Документация

- Инструкция по локальной сборке
- Инструкция по скачиванию APK из CI
- Описание архитектуры и реализации
- Руководство по настройке

## Архитектурные решения

### 1. Модульность

Модуль `chatAI` полностью независим от Android Framework (кроме Room), что позволяет:
- Переиспользовать бизнес-логику в других проектах
- Легко тестировать компоненты
- Изолировать изменения UI от логики

### 2. MVVM Pattern

```
View (Compose) ←→ ViewModel ←→ UseCase ←→ Repository ←→ DataSource
```

- **View:** Jetpack Compose компоненты
- **ViewModel:** управление состоянием UI через StateFlow
- **UseCase:** инкапсуляция бизнес-логики
- **Repository:** абстракция над источниками данных
- **DataSource:** Room Database, API Service

### 3. Реактивное программирование

- **StateFlow** для состояния UI (ViewModel → View)
- **Flow** для реактивного получения данных из Room
- Автоматическое обновление UI при изменении данных

### 4. Dependency Injection (Koin)

Все зависимости регистрируются централизованно в `AppModule`:
- Database и DAO
- Repository
- API Service
- Use Cases
- ViewModels

## Особенности реализации

### Роли сообщений

Поддерживаются все требуемые роли:
- **SYSTEM** - системные сообщения (промпты)
- **USER** - сообщения пользователя
- **ASSISTANT** - ответы AI ассистента
- **TOOL** - результаты вызова инструментов
- **MCP** - сообщения от MCP серверов

### Восстановление истории

История автоматически:
- Сохраняется в Room при каждом сообщении
- Загружается из базы при запуске приложения
- Отображается в UI через Flow

### Обработка ошибок

- Использование `Result<T>` в UseCase для безопасной обработки ошибок
- Отображение ошибок через Snackbar в UI
- Graceful degradation при сетевых проблемах

## Production-ready код

- Корректная обработка ошибок
- Использование современных Android API (не deprecated)
- Оптимизация производительности (Flow для реактивности)
- Безопасность (API ключ через ресурсы, не hardcoded)
- Модульность и переиспользование кода
- Четкая структура проекта

## Файловая структура

```
android/
├── app/                          # Основной модуль
│   ├── src/main/java/org/example/aichallenge/
│   │   ├── MainActivity.kt
│   │   ├── di/                   # Koin модуль
│   │   └── ui/                   # Jetpack Compose UI
│   │       ├── screen/
│   │       ├── components/
│   │       ├── viewmodel/
│   │       └── theme/
│   └── build.gradle.kts
└── chatAI/                       # Модуль бизнес-логики
    ├── src/main/java/org/example/chatai/
    │   ├── data/                 # Data слой (Room, Repository)
    │   └── domain/               # Domain слой (UseCase, API)
    └── build.gradle.kts

.github/
└── workflows/
    └── android-ci.yml            # GitHub Actions workflow
```

## Результаты

✅ Все требования выполнены
✅ Модульная архитектура реализована
✅ Room база данных настроена
✅ CI/CD pipeline работает
✅ Документация создана
