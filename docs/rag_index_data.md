# Тестовые данные для индексации RAG

## Описание проекта OpenRouter Agent

OpenRouter Agent - это AI-агент на Kotlin, который использует OpenRouter API для взаимодействия с различными языковыми моделями. Проект реализует систему RAG (Retrieval-Augmented Generation) для улучшения качества ответов за счет использования локальной базы знаний.

## Архитектура системы

### Основные компоненты

1. **OpenRouterAgent** - основной класс агента, обрабатывающий запросы пользователей
2. **RagService** - сервис для поиска релевантных документов в локальной базе данных
3. **EmbeddingClient** - клиент для генерации векторных представлений текста
4. **DocumentIndexStorage** - хранилище индексированных документов в SQLite

### Процесс работы RAG

1. Пользователь задает вопрос
2. Система генерирует эмбеддинг для запроса
3. Выполняется поиск похожих документов в базе данных
4. Найденные чанки добавляются как контекст к запросу
5. LLM генерирует ответ на основе контекста и вопроса

## MCP stdio Transport

MCP stdio transport - это механизм передачи данных через стандартный ввод/вывод (stdio) в контексте протокола MCP (Model Context Protocol). Он использует неблокирующий I/O с Kotlin Coroutines для эффективной обработки запросов.

### Особенности реализации

- Поддержка stdio транспорта для MCP протокола
- Неблокирующий I/O с использованием Kotlin Coroutines
- Конфигурируемый выбор транспорта (HTTP/stdio)
- Обработка ошибок и таймаутов

## Android Emulator Agent

Android Emulator Agent - это компонент системы, который позволяет автоматически запускать Android эмулятор и выполнять поиск на устройстве через Chrome браузер. Агент определяет намерения пользователя для автоматизации задач.

### Функциональность

- Автоматический запуск Android эмулятора
- Поиск на устройстве через Chrome браузер
- Определение намерений пользователя для автоматизации
- Интеграция с DeviceSearchService

## Инструменты агента

### Доступные инструменты

1. **get_current_time** - получение текущего времени
2. **calculator** - математические вычисления (add, subtract, multiply, divide, power, sqrt)
3. **search** - поиск информации (эмуляция)
4. **random_number** - генерация случайного числа в заданном диапазоне
5. **get_weather** - получение данных о погоде
6. **append_notion_block** - добавление блока в Notion страницу
7. **get_notion_page** - получение информации о странице Notion

## Режим сравнения RAG

Режим сравнения RAG позволяет сравнивать ответы модели с использованием RAG и без него. Это помогает оценить эффективность системы и определить, когда RAG наиболее полезен.

### Как работает сравнение

1. Вопрос обрабатывается дважды: без RAG и с RAG
2. Система выводит оба ответа и анализ различий
3. Метрики включают длину ответов, количество слов и схожесть
4. Автоматический анализ определяет влияние RAG

### Команды управления

- `/rag` - переключение RAG режима (вкл/выкл)
- `/rag-compare` - переключение режима сравнения (вкл/выкл)

## Параметры RAG

В RagService можно настроить следующие параметры:

- `minSimilarity` (по умолчанию 0.6) - минимальный порог сходства для включения чанка
- `maxChunks` (по умолчанию 3) - максимальное количество чанков для контекста

## Этапы разработки

### Stage 1: Анализ
Первоначальный анализ требований и проектирование архитектуры системы.

### Stage 2: MCP stdio Transport
Реализация поддержки stdio транспорта для MCP протокола с неблокирующим I/O.

### Stage 3: Android Emulator Agent
Разработка компонента для автоматизации работы с Android эмулятором.

### Stage 4: Валидация
Тестирование и валидация всех компонентов системы.

## Технологический стек

- **Kotlin** - основной язык программирования
- **Ktor** - фреймворк для создания HTTP серверов и клиентов
- **Coroutines** - асинхронное программирование
- **SQLite** - база данных для хранения индексов документов
- **OpenRouter API** - API для работы с языковыми моделями

## Преимущества RAG

✅ **Быстрый поиск** - поиск в локальной БД быстрее, чем в интернете  
✅ **Актуальная информация** - использует ваши собственные документы  
✅ **Контроль данных** - полный контроль над источниками информации  
✅ **Работа offline** - поиск работает без интернета (кроме генерации эмбеддингов запросов)  
✅ **Точность** - семантический поиск находит релевантную информацию даже при неполном совпадении слов

## Ограничения

⚠️ Для генерации эмбеддингов запросов все еще требуется доступ к OpenRouter API  
⚠️ Если в индексе нет релевантной информации, система продолжит работу без RAG контекста  
⚠️ RAG работает только с проиндексированными документами

## Примеры использования

### Пример 1: Вопрос о специфической технологии
**Вопрос:** "Что такое MCP stdio transport?"
**Ожидание:** RAG должен найти релевантные чанки и улучшить ответ

### Пример 2: Вопрос об архитектуре
**Вопрос:** "Расскажи про архитектуру проекта"
**Ожидание:** RAG должен предоставить детальную информацию о компонентах

### Пример 3: Общий вопрос
**Вопрос:** "Что такое искусственный интеллект?"
**Ожидание:** RAG может не найти релевантный контекст, ответ будет общим




